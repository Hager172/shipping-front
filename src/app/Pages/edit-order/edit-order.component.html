<div class="container mt-4 p-4" style="background-color: #ebfdff; border-radius: 8px;">
  <h4 class="text-white p-2 mb-4" style="background-color: #083c3e; border-radius: 4px;">
    Edit Order #{{ orderId }}
  </h4>
  <form #orderForm="ngForm" (ngSubmit)="submitOrder()">
    <div class="row g-3 row-cols-1 row-cols-md-3">
      <div class="col"><label>Customer Name</label>
        <input type="text" class="form-control" [(ngModel)]="order.customerName" name="customerName" required />
      </div>
      <div class="col"><label>Email</label>
        <input type="email" class="form-control" [(ngModel)]="order.email" name="email" required />
      </div>
      <div class="col"><label>Phone 1</label>
        <input type="text" class="form-control" [(ngModel)]="order.phone1" name="phone1" required />
      </div>
      <div class="col"><label>Phone 2</label>
        <input type="text" class="form-control" [(ngModel)]="order.phone2" name="phone2" />
      </div>

      <!-- Governorate -->
      <div class="col"><label>Governorate</label>
        <select class="form-select"
                [(ngModel)]="order.governorateId"
                name="governorateId"
                (ngModelChange)="handleSelectionChange('governorateId', $event)">
          <option [ngValue]="''">Select Governorate</option>
          <option *ngFor="let gov of governorates" [ngValue]="gov.id">{{ gov.name }}</option>
        </select>
      </div>

      <!-- City -->
      <div class="col"><label>City</label>
        <select class="form-select"
                [(ngModel)]="order.cityId"
                name="cityId"
                (ngModelChange)="handleSelectionChange('cityId', $event)">
          <option [ngValue]="''">Select City</option>
          <option *ngFor="let c of cities" [ngValue]="c.id">{{ c.name }}</option>
        </select>
      </div>

      <div class="col"><label>Street Address</label>
        <input type="text" class="form-control" [(ngModel)]="order.streetAddress" name="streetAddress" />
      </div>

      <!-- Delivery Type -->
      <div class="col"><label>Delivery Type</label>
        <select class="form-select"
                [(ngModel)]="order.deliveryType"
                name="deliveryType"
                (ngModelChange)="handleSelectionChange('deliveryType', $event)">
          <option *ngFor="let dt of deliveryTypes" [ngValue]="dt.value">{{ dt.label }}</option>
        </select>
      </div>

      <!-- Shipping Type -->
      <div class="col"><label>Shipping Type</label>
        <select class="form-select"
                [(ngModel)]="order.shippingTypeId"
                name="shippingTypeId"
                (ngModelChange)="handleSelectionChange('shippingTypeId', $event)">
          <option [ngValue]="''">Select Shipping Type</option>
          <option *ngFor="let st of shippingTypes" [ngValue]="st.id">{{ st.typeName }}</option>
        </select>
      </div>

      <!-- Payment Type -->
      <div class="col"><label>Payment Type</label>
        <select class="form-select"
                [(ngModel)]="order.paymentType"
                name="paymentType"
                (ngModelChange)="handleSelectionChange('paymentType', $event)">
          <option *ngFor="let pt of paymentTypes" [ngValue]="pt.value">{{ pt.label }}</option>
        </select>
      </div>

      <!-- Branch -->
      <div class="col"><label>Branch</label>
        <select class="form-select"
                [(ngModel)]="order.branchId"
                name="branchId"
                (ngModelChange)="handleSelectionChange('branchId', $event)">
          <option [ngValue]="''">Select Branch</option>
          <option *ngFor="let b of branches" [ngValue]="b.id">{{ b.name }}</option>
        </select>
      </div>

      <!-- Trader -->
      <div class="col"><label>Trader</label>
        <select class="form-select" [(ngModel)]="order.traderId" name="traderId">
          <option *ngFor="let tr of traders" [value]="tr.userId">{{ tr.fullName }}</option>
        </select>
      </div>

      <div class="col"><label>Total Weight</label>
        <input type="number" class="form-control" [(ngModel)]="order.totalWeight" name="totalWeight" />
      </div>
      <div class="col"><label>Order Cost</label>
        <input type="number" class="form-control" [(ngModel)]="order.orderCost" name="orderCost" />
      </div>
      <div class="col-12"><label>Notes</label>
        <textarea class="form-control" [(ngModel)]="order.notes" name="notes"></textarea>
      </div>
    </div>

    <hr class="my-4" />
    <h5 class="text-secondary">Order Items</h5>

    <div class="row g-3 mt-2">
      <div class="col-md-4"><label>Product Name</label>
        <input type="text" class="form-control" [(ngModel)]="newItem.productName" name="productName" />
      </div>
      <div class="col-md-4"><label>Quantity</label>
        <input type="number" class="form-control" [(ngModel)]="newItem.quantity" name="quantity" />
      </div>
      <div class="col-md-4"><label>Weight</label>
        <input type="number" class="form-control" [(ngModel)]="newItem.weight" name="weight" />
      </div>
      <div class="col-12 text-end">
        <app-button-style
          [label]="'Add Item'"
          [className]="'btn custom-btn px-3 py-1 btn-sm'"
          [onClick]="addItem.bind(this)">
        </app-button-style>
      </div>
    </div>

    <ul *ngIf="order.items?.length" class="list-group mt-3">
      <li *ngFor="let item of order.items; index as i"
          class="list-group-item d-flex justify-content-between align-items-center">
        {{ item.productName }} â€“ Qty: {{ item.quantity }}, Weight: {{ item.weight }}kg
        <button type="button" class="btn btn-sm btn-outline-danger" (click)="removeItem(i)">Remove</button>
      </li>
    </ul>

    <div class="mt-4">
      <app-button-style
        [label]="'Save Changes'"
        [className]="'btn custom-btn px-4 py-2'"
        [onClick]="submitOrder.bind(this)">
      </app-button-style>
    </div>
  </form>
</div>
